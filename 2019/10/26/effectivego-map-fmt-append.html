<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>《原汁原味 Go 语言学习》(7) effective go 数据部分：map、fmt包、append - 敬维</title>
    <meta name="author"  content="敬维">
    <meta name="description" content="《原汁原味 Go 语言学习》(7) effective go 数据部分：map、fmt包、append">
    <meta name="keywords"  content="golang, 基础, 实用">
    <!-- Open Graph -->
    <meta property="og:title" content="《原汁原味 Go 语言学习》(7) effective go 数据部分：map、fmt包、append - 敬维">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jingwei.link/2019/10/26/effectivego-map-fmt-append.html">
    <meta property="og:description" content="一个喜欢涂涂画画的人，曾经的Rubist，一个CI/CD的践行者，一个探寻最佳实践的人。">
    <meta property="og:site_name" content="敬维">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121993438-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-121993438-1');
    </script>
</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header class="g-banner post-header post-pattern-circuitBoard bgcolor-default " data-theme="default">
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="https://jingwei.link/tags#golang" class="post-tag">golang</a>
          
            <a href="https://jingwei.link/tags#%E5%9F%BA%E7%A1%80" class="post-tag">基础</a>
          
            <a href="https://jingwei.link/tags#%E5%AE%9E%E7%94%A8" class="post-tag">实用</a>
          
        
      </div>
      <h1>《原汁原味 Go 语言学习》(7) effective go 数据部分：map、fmt包、append</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="https://jingwei.link" target="_blank" rel="author">敬维</a></></span>
        <time class="post-meta-item" datetime="19-10-26"><i class="iconfont icon-date"></i>26 Oct 2019</time>
      </div>
    </div>
    
    <div class="filter"></div>
      <div class="post-cover" style="background: url('') center no-repeat; background-size: cover;"></div>
    
  </header>

  <div class="post-content visible">
    
    <h2 class="post-subtitle">Go 语言官方文档 effective go 中数据小节里的映射 map、fmt打印函数、追加append函数</h2>
    

    <article class="markdown-body">
      <ul id="markdown-toc">
  <li><a href="#资料" id="markdown-toc-资料">资料</a></li>
  <li><a href="#数据" id="markdown-toc-数据">数据</a>    <ul>
      <li><a href="#映射" id="markdown-toc-映射">映射</a></li>
      <li><a href="#打印" id="markdown-toc-打印">打印</a></li>
      <li><a href="#append追加" id="markdown-toc-append追加">Append（追加）</a></li>
    </ul>
  </li>
</ul>

<h2 id="资料">资料</h2>
<p><a href="https://golang.google.cn/doc/effective_go.html">effective go 源文档地址</a></p>

<h1 id="数据">数据</h1>

<h2 id="映射">映射</h2>
<p>映射（map）是一种既方便使用又功能强大的内建数据结构，它把一种类型的值（键）和另一种类型的值（值）关联起来。任何可以比较相等性的类型都可以作为键来使用，比如整数、浮点数、复数、字符串、指针、动态类型可以判定相等性接口、结构和数组。因为两个切片不能直接进行比较，因此不可以把切片作为映射的键。和切片类似，映射持有底层数据结构的引用。当把映射传递给函数时，如果函数修改了映射里的内容，函数调用者是可以感知到的。</p>

<p>映射可以使用普通的复合字面语句进行创建，键值对之间通过逗号分隔，语法简单，方便使用。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span><span class="x"> </span><span class="n">timeZone</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="x">
    </span><span class="s">"UTC"</span><span class="o">:</span><span class="x">  </span><span class="m">0</span><span class="o">*</span><span class="m">60</span><span class="o">*</span><span class="m">60</span><span class="p">,</span><span class="x">
    </span><span class="s">"EST"</span><span class="o">:</span><span class="x"> </span><span class="o">-</span><span class="m">5</span><span class="o">*</span><span class="m">60</span><span class="o">*</span><span class="m">60</span><span class="p">,</span><span class="x">
    </span><span class="s">"CST"</span><span class="o">:</span><span class="x"> </span><span class="o">-</span><span class="m">6</span><span class="o">*</span><span class="m">60</span><span class="o">*</span><span class="m">60</span><span class="p">,</span><span class="x">
    </span><span class="s">"MST"</span><span class="o">:</span><span class="x"> </span><span class="o">-</span><span class="m">7</span><span class="o">*</span><span class="m">60</span><span class="o">*</span><span class="m">60</span><span class="p">,</span><span class="x">
    </span><span class="s">"PST"</span><span class="o">:</span><span class="x"> </span><span class="o">-</span><span class="m">8</span><span class="o">*</span><span class="m">60</span><span class="o">*</span><span class="m">60</span><span class="p">,</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>从映射中存取键值对的语法和数组、切片的语法类似，只不过映射的键可能是整数之外的类型。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">offset</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">timeZone</span><span class="p">[</span><span class="s">"EST"</span><span class="p">]</span><span class="x">
</span></code></pre></div></div>

<p>如果尝试获取映射中没有的键值对，得到的是映射值的类型的零值。比如，如果映射的值保存的是整数（类似 <code class="highlighter-rouge">var a map[string]int</code>)，查找不存在的键值会直接返回 <code class="highlighter-rouge">0</code>，不会抛出任何错误。基于这个特性，我们可以使用值为 <code class="highlighter-rouge">bool</code> 类型的映射实现一个集合：把某个键的值设置为 <code class="highlighter-rouge">true</code> 表示对应的值添加到集合里面了，之后就可以通过键来检测它的存在了。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">attended</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span><span class="x">
    </span><span class="s">"Ann"</span><span class="o">:</span><span class="x"> </span><span class="no">true</span><span class="p">,</span><span class="x">
    </span><span class="s">"Joe"</span><span class="o">:</span><span class="x"> </span><span class="no">true</span><span class="p">,</span><span class="x">
    </span><span class="o">...</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">if</span><span class="x"> </span><span class="n">attended</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="x"> </span><span class="p">{</span><span class="x"> </span><span class="c">// will be false if person is not in the map</span><span class="x">
    </span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="x"> </span><span class="s">"was at the meeting"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>因为在映射中不存在的键值的值是零值，有时候可能需要区分“键不存在”还是“对应的键的值被设定为零值”这两种情况。上面 <code class="highlighter-rouge">timeZone</code> 中 <code class="highlighter-rouge">UTC</code> 的值是 <code class="highlighter-rouge">0</code>，我们怎么判定映射中有 <code class="highlighter-rouge">UTC</code> 的键呢？当我们取 <code class="highlighter-rouge">timeZone["UTC"]</code> 时返回了 <code class="highlighter-rouge">0</code> 是因为它不存在于映射中还是因为它本身的值就是 <code class="highlighter-rouge">0</code>？此时可以通过多值赋值的方式来判定这种情况：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span><span class="x"> </span><span class="n">seconds</span><span class="x"> </span><span class="kt">int</span><span class="x">
</span><span class="k">var</span><span class="x"> </span><span class="n">ok</span><span class="x"> </span><span class="kt">bool</span><span class="x">
</span><span class="n">seconds</span><span class="p">,</span><span class="x"> </span><span class="n">ok</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">timeZone</span><span class="p">[</span><span class="n">tz</span><span class="p">]</span><span class="x">
</span></code></pre></div></div>

<p>上面展示的是 <strong>“逗号与ok”</strong> 的惯用语法。在这个例子中，如果 <code class="highlighter-rouge">tz</code> 存在，<code class="highlighter-rouge">seconds</code> 将会被正确设置，此时 <code class="highlighter-rouge">ok</code> 的值为 <code class="highlighter-rouge">true</code>；如果 <code class="highlighter-rouge">tz</code> 不存在，<code class="highlighter-rouge">seconds</code> 会被设置为 0， <code class="highlighter-rouge">ok</code> 会被设置为 <code class="highlighter-rouge">false</code>。下面的函数把 <strong>“逗号与ok”</strong> 的用法和错误提示结合在了一起：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="n">offset</span><span class="p">(</span><span class="n">tz</span><span class="x"> </span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="kt">int</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">seconds</span><span class="p">,</span><span class="x"> </span><span class="n">ok</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">timeZone</span><span class="p">[</span><span class="n">tz</span><span class="p">];</span><span class="x"> </span><span class="n">ok</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="k">return</span><span class="x"> </span><span class="n">seconds</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"unknown time zone:"</span><span class="p">,</span><span class="x"> </span><span class="n">tz</span><span class="p">)</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="m">0</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>如果只是想知道映射中是否存在某个元素，不需要知道具体的值，可以用<strong>空标识符</strong>替代接收变量：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">present</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">timeZone</span><span class="p">[</span><span class="n">tz</span><span class="p">]</span><span class="x">
</span></code></pre></div></div>

<p>如果想删除映射中的某个键值对，可以使用内建函数 <code class="highlighter-rouge">delete</code> 来实现，参数是映射和将要删除的键。这个函数可以在键存在的时候调用也可以在键不存在的时候调用，多次不会报错，用起来很省心 :)</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">delete</span><span class="p">(</span><span class="n">timeZone</span><span class="p">,</span><span class="x"> </span><span class="s">"PDT"</span><span class="p">)</span><span class="x">  </span><span class="c">// Now on Standard Time</span><span class="x">
</span></code></pre></div></div>

<h2 id="打印">打印</h2>

<p>为了能格式化打印内容，Go 有一组和 C 中的 <code class="highlighter-rouge">printf</code> 类似的函数，而且功能更丰富也更通用。这些函数在 <code class="highlighter-rouge">fmt</code> 包中，名字的首字母都是大写的：<code class="highlighter-rouge">fmt.Printf</code>, <code class="highlighter-rouge">fmt.Fprintf</code>, <code class="highlighter-rouge">fmt.Sprintf</code>，等等。字符串函数（<code class="highlighter-rouge">Sprintf</code>等，以 <code class="highlighter-rouge">S</code> 开头）返回一个字符串，其他函数会把内容直接填充到某个缓冲区里。</p>

<p>以 <code class="highlighter-rouge">f</code> 结尾的函数都需要传入一个格式化字符串作为参数，为了使用上的方便，也有不需要提供格式化字符串的函数。对于 <code class="highlighter-rouge">Printf</code>, <code class="highlighter-rouge">Fprintf</code> 和 <code class="highlighter-rouge">Sprintf</code> 等函数都有对应不需要格式化字符串的函数，比如 <code class="highlighter-rouge">Print</code> 和 <code class="highlighter-rouge">Println</code>等，这几个函数会给每个参数生成一个默认的格式。其中 <code class="highlighter-rouge">Println</code> 会给参数之间插入一个空白符，并且在最后的输出追加一个行尾符；<code class="highlighter-rouge">Print</code> 函数会在<strong>非字符串参数之间</strong>添加一个空白符。下面的例子每行打印的内容都是一样的：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Hello %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="m">23</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Fprint</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span><span class="x"> </span><span class="s">"Hello "</span><span class="p">,</span><span class="x"> </span><span class="m">23</span><span class="p">,</span><span class="x"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span><span class="x"> </span><span class="m">23</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="s">"Hello "</span><span class="p">,</span><span class="x"> </span><span class="m">23</span><span class="p">))</span><span class="x">
</span></code></pre></div></div>

<p>格式化打印函数 <code class="highlighter-rouge">fmt.Fprint</code> 及其他以 <code class="highlighter-rouge">F</code> 开头的打印函数的第一个参数是实现了 <code class="highlighter-rouge">io.Writer</code> 接口的任意对象，<code class="highlighter-rouge">os.Stdout</code> 和 <code class="highlighter-rouge">os.Stderr</code> 就是这样的对象。</p>

<p>这里有一些和 C 语言不一样的地方。首先，数字化格式符（比如 <code class="highlighter-rouge">%d</code>）不接受符号类型或大小；相反，打印例程通过参数的类型来决定这些属性。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span><span class="x"> </span><span class="n">x</span><span class="x"> </span><span class="kt">uint64</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">64</span><span class="x"> </span><span class="o">-</span><span class="x"> </span><span class="m">1</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%d %x; %d %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">x</span><span class="p">,</span><span class="x"> </span><span class="n">x</span><span class="p">,</span><span class="x"> </span><span class="kt">int64</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="x"> </span><span class="kt">int64</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="x">
</span></code></pre></div></div>

<p>打印内容如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18446744073709551615 ffffffffffffffff<span class="p">;</span> <span class="nt">-1</span> <span class="nt">-1</span>
</code></pre></div></div>

<p>如果只是想要默认的格式转换，比如把整数作为十进制数值来打印，可以使用万能格式符 <code class="highlighter-rouge">%v</code>（value 的首字母）；这也是 <code class="highlighter-rouge">Print</code> 和 <code class="highlighter-rouge">Println</code> 默认的打印模式。事实上，<code class="highlighter-rouge">%v</code> 格式符可以用来打印任意类型的值，包含数组、切片、结构和 map 映射。下面的例子打印了之前小节定义的时区映射变量。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">timeZone</span><span class="p">)</span><span class="x">  </span><span class="c">// or just fmt.Println(timeZone)</span><span class="x">
</span></code></pre></div></div>

<p>上面的代码会输出下面的内容：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map[CST:-21600 EST:-18000 MST:-25200 PST:-28800 UTC:0]
</code></pre></div></div>

<p>对于映射， <code class="highlighter-rouge">Printf</code> 及其他相关函数会<strong>按照索引的字母排序</strong>进行输出。</p>

<p>当打印结构体时，格式化符 <code class="highlighter-rouge">%+v</code> 表示同时打印结构体的字段名和值；对于任意的值，<code class="highlighter-rouge">%#v</code> 则会以 Go 语法的格式把值打印出来，意味着我们可以直接把打印出来的内容赋值到源码中直接作为代码片段来使用。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">T</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">a</span><span class="x"> </span><span class="kt">int</span><span class="x">
    </span><span class="n">b</span><span class="x"> </span><span class="kt">float64</span><span class="x">
    </span><span class="n">c</span><span class="x"> </span><span class="kt">string</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">t</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">T</span><span class="p">{</span><span class="x"> </span><span class="m">7</span><span class="p">,</span><span class="x"> </span><span class="o">-</span><span class="m">2.35</span><span class="p">,</span><span class="x"> </span><span class="s">"abc</span><span class="se">\t</span><span class="s">def"</span><span class="x"> </span><span class="p">}</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%+v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%#v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%#v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">timeZone</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>打印内容如下（注意 <strong>&amp;</strong> 符号）：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&amp;</span><span class="p">{</span><span class="m">7</span><span class="x"> </span><span class="o">-</span><span class="m">2.35</span><span class="x"> </span><span class="n">abc</span><span class="x">   </span><span class="n">def</span><span class="p">}</span><span class="x">
</span><span class="o">&amp;</span><span class="p">{</span><span class="n">a</span><span class="o">:</span><span class="m">7</span><span class="x"> </span><span class="n">b</span><span class="o">:-</span><span class="m">2.35</span><span class="x"> </span><span class="n">c</span><span class="o">:</span><span class="n">abc</span><span class="x">     </span><span class="n">def</span><span class="p">}</span><span class="x">
</span><span class="o">&amp;</span><span class="n">main</span><span class="o">.</span><span class="n">T</span><span class="p">{</span><span class="n">a</span><span class="o">:</span><span class="m">7</span><span class="p">,</span><span class="x"> </span><span class="n">b</span><span class="o">:-</span><span class="m">2.35</span><span class="p">,</span><span class="x"> </span><span class="n">c</span><span class="o">:</span><span class="s">"abc</span><span class="se">\t</span><span class="s">def"</span><span class="p">}</span><span class="x">
</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">"CST"</span><span class="o">:-</span><span class="m">21600</span><span class="p">,</span><span class="x"> </span><span class="s">"EST"</span><span class="o">:-</span><span class="m">18000</span><span class="p">,</span><span class="x"> </span><span class="s">"MST"</span><span class="o">:-</span><span class="m">25200</span><span class="p">,</span><span class="x"> </span><span class="s">"PST"</span><span class="o">:-</span><span class="m">28800</span><span class="p">,</span><span class="x"> </span><span class="s">"UTC"</span><span class="o">:</span><span class="m">0</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>当需要打印的值是 <code class="highlighter-rouge">string</code> 或 <code class="highlighter-rouge">[]byte</code> 时，双引号括起来的字符串格式可以通过 <code class="highlighter-rouge">%q</code> 获得；而 <code class="highlighter-rouge">%#q</code> 会给字符串加上反引号。<code class="highlighter-rouge">%q</code> 也可以格式化整形和符文类型，生成的是单引号括起来的符文常量。与此同时， <code class="highlighter-rouge">%x</code> 可以作用于字符串、字节数组、字节切片，如果传入的是一个整数会生成一个十六进制字符串；如果加一个空格——<code class="highlighter-rouge">% x</code>——会在每个字节之间加一个空格。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">"hello 世界"</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%q</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">str</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%#q</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">str</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%+q</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">str</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">str</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"% x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">str</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="m">12</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>打印的结果如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"hello 世界"</span>
<span class="sb">`</span>hello 世界<span class="sb">`</span>
<span class="s2">"hello </span><span class="se">\u</span><span class="s2">4e16</span><span class="se">\u</span><span class="s2">754c"</span>
68656c6c6f20e4b896e7958c
68 65 6c 6c 6f 20 e4 b8 96 e7 95 8c
c
</code></pre></div></div>

<p>另一个使用起来很方便的格式符是 <code class="highlighter-rouge">%T</code>，它可以把值的类型打印出来。<code class="highlighter-rouge">fmt.Printf("%T\n", timeZone)</code> 的打印结果是 <code class="highlighter-rouge">map[string]int</code>。</p>

<p>如果想控制自定义类型的打印格式，只需要给相应的类型定义一个签名为 <code class="highlighter-rouge">String() string</code> 的方法。对于简单类型 <code class="highlighter-rouge">T</code>，其可能的方法如下：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">t</span><span class="x"> </span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="x"> </span><span class="n">String</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%d/%g/%q"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>上面的代码会打印出下面的结果：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">7</span><span class="o">/-</span><span class="m">2.35</span><span class="o">/</span><span class="s">"abc</span><span class="se">\t</span><span class="s">def"</span><span class="x">
</span></code></pre></div></div>

<p>如果想打印类型 <code class="highlighter-rouge">T</code> 及其指针的值，<code class="highlighter-rouge">String</code> 方法的接收者必须是值类型；上面的例子接受者使用了指针，是因为对于结构体来说指针更高效且惯用。可以查看《指针接收器与值接收器》一节了解更多内容。</p>

<p>自定义的 <code class="highlighter-rouge">String</code> 函数里面可以调用 <code class="highlighter-rouge">Sprintf</code> 函数，因为打印的例程完全可重入。但是，有一个很重要的细节需要理解：不能在 <code class="highlighter-rouge">String</code> 方法里面以某种方式调用 <code class="highlighter-rouge">Sprintf</code> 函数，然后 <code class="highlighter-rouge">Sprintf</code> 再触发调用 <code class="highlighter-rouge">String</code> 方法，如此往复形成死循环。如果 <code class="highlighter-rouge">Sprintf</code> 尝试以字符串的形式直接打印接受者就可能会无限调用自定义的 <code class="highlighter-rouge">String</code> 函数。比如下面的例子：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">MyString</span><span class="x"> </span><span class="kt">string</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">m</span><span class="x"> </span><span class="n">MyString</span><span class="p">)</span><span class="x"> </span><span class="n">String</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"MyString=%s"</span><span class="p">,</span><span class="x"> </span><span class="n">m</span><span class="p">)</span><span class="x"> </span><span class="c">// Error: will recur forever.</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>上面的问题也很容易修复：只需把参数转换为基础的字符串类型即可，如下面的代码所示：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">MyString</span><span class="x"> </span><span class="kt">string</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">m</span><span class="x"> </span><span class="n">MyString</span><span class="p">)</span><span class="x"> </span><span class="n">String</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"MyString=%s"</span><span class="p">,</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="x"> </span><span class="c">// OK: note conversion.</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>在《初始化一节》我们还会看到另一个避免这种循环调用的技术。</p>

<p>还有一种打印用法是把一个打印例程的参数直接传给另一个类似的例程。函数 <code class="highlighter-rouge">Printf</code> 的声明中使用 <code class="highlighter-rouge">...interface{}</code> 作为它的最后一个参数类型，因此可以在格式字符串后面传递任意数量任意类型的参数。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="n">Printf</span><span class="p">(</span><span class="n">format</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">...</span><span class="k">interface</span><span class="p">{})</span><span class="x"> </span><span class="p">(</span><span class="n">n</span><span class="x"> </span><span class="kt">int</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
</span></code></pre></div></div>

<p>在函数 <code class="highlighter-rouge">Printf</code> 中，<code class="highlighter-rouge">v</code> 就像是类型 <code class="highlighter-rouge">[]interface{}</code> 的值，可以把它作为正常的参数列表传递给另一个不定参数的函数。下面的代码是 <code class="highlighter-rouge">log.Println</code> 的一种实现，它把自己的参数传给了<code class="highlighter-rouge">fmt.Sprintln</code> 进行实际的格式输出。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Println prints to the standard logger in the manner of fmt.Println.</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">Println</span><span class="p">(</span><span class="n">v</span><span class="x"> </span><span class="o">...</span><span class="k">interface</span><span class="p">{})</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">std</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintln</span><span class="p">(</span><span class="n">v</span><span class="o">...</span><span class="p">))</span><span class="x">  </span><span class="c">// Output takes parameters (int, string)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>在上面的代码示例中，调用 <code class="highlighter-rouge">Sprintln</code> 时在 <code class="highlighter-rouge">v</code> 后添加了 <code class="highlighter-rouge">...</code> 从而把 <code class="highlighter-rouge">v</code> 作为一个参数列表传入；如果没有这三个点，<code class="highlighter-rouge">v</code> 会作为一个切片类型的值传递给 <code class="highlighter-rouge">Sprintln</code>。</p>

<p>可以查看 <code class="highlighter-rouge">godoc</code> 中 <code class="highlighter-rouge">fmt</code> 的文档了解更多打印相关的内容。</p>

<p>顺便提一句，<code class="highlighter-rouge">...</code> 参数可以作为一个特殊的类型，比如查找最小值的函数可以传入 <code class="highlighter-rouge">...int</code> 类型的参数，然后选择列表中最小的整数。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="n">Min</span><span class="p">(</span><span class="n">a</span><span class="x"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="x"> </span><span class="kt">int</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">min</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="kt">int</span><span class="p">(</span><span class="o">^</span><span class="kt">uint</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="x"> </span><span class="o">&gt;&gt;</span><span class="x"> </span><span class="m">1</span><span class="p">)</span><span class="x">  </span><span class="c">// largest int</span><span class="x">
    </span><span class="k">for</span><span class="x"> </span><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">a</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="k">if</span><span class="x"> </span><span class="n">i</span><span class="x"> </span><span class="o">&lt;</span><span class="x"> </span><span class="n">min</span><span class="x"> </span><span class="p">{</span><span class="x">
            </span><span class="n">min</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">i</span><span class="x">
        </span><span class="p">}</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="k">return</span><span class="x"> </span><span class="n">min</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<h2 id="append追加">Append（追加）</h2>

<p>接下来我们继续聊内建函数 <code class="highlighter-rouge">append</code> 的相关内容。内建函数 <code class="highlighter-rouge">append</code> 的声明方式和我们上面自定义的 <code class="highlighter-rouge">Append</code> 函数不同，如下面的形式：</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="nb">append</span><span class="p">(</span><span class="n">slice</span><span class="x"> </span><span class="p">[]</span><span class="n">T</span><span class="p">,</span><span class="x"> </span><span class="n">elements</span><span class="x"> </span><span class="o">...</span><span class="n">T</span><span class="p">)</span><span class="x"> </span><span class="p">[]</span><span class="n">T</span><span class="x">
</span></code></pre></div></div>

<p>这里的 <em>T</em> 是一个占位符，用来表示任意给定的类型。实际上，在 Go 语言中我们不能写带泛型的函数，这也是 <code class="highlighter-rouge">append</code> 是内建函数的原因——它需要编译器层面的支持。</p>

<p><code class="highlighter-rouge">append</code> 做的事情是在一个切片的尾部追加元素，然后返回追加以后的结果。<code class="highlighter-rouge">append</code> 函数必须要返回结果，原因就像我们手写的 <code class="highlighter-rouge">Append</code> 函数一样，在追加过程中，切片底层的数组可能会发生变化，此时必须通过返回结果来通知这种变化。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">}</span><span class="x">
</span><span class="n">x</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="nb">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="x"> </span><span class="m">4</span><span class="p">,</span><span class="x"> </span><span class="m">5</span><span class="p">,</span><span class="x"> </span><span class="m">6</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>上面的例子打印出 <code class="highlighter-rouge">[1 2 3 4 5 6]</code>。一定程度上可以认为 <code class="highlighter-rouge">append</code> 的传参方式和 <code class="highlighter-rouge">Printf</code> 有点像，可以传入任意多数目的参数。</p>

<p>如果想使用 <code class="highlighter-rouge">append</code> 函数把一个切片追加到另一个切片后面，必须使用 <code class="highlighter-rouge">...</code> 运算符，类似上面中 <code class="highlighter-rouge">Output</code> 展示的用法。下面的代码输出的内容和上面的代码输出的内容是一样的。</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">}</span><span class="x">
</span><span class="n">y</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">}</span><span class="x">
</span><span class="n">x</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="nb">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="x"> </span><span class="n">y</span><span class="o">...</span><span class="p">)</span><span class="x">
</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>在上面的例子中，如果不带 <code class="highlighter-rouge">...</code>，代码没有办法编译通过，因为 <code class="highlighter-rouge">y</code> 的类型是一个切片而不是需要的 <code class="highlighter-rouge">int</code>。</p>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="https://jingwei.link/assets/img/profile.png" alt="">
      </div>
      <div class="author-name" rel="author">敬维</div>
      <div class="bio">
        <p>Stay hungry, stay foolish</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="mailto:zhjw43@163.com" target="_blank">
                    <i class="iconfont icon-email"></i>
                </a>
        </li>
        
        <li>
          <a href="https://github.com/chalvern" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
        <li>
          <a href="https://weibo.com/zhjw43" target="_blank">
                    <i class="iconfont icon-weibo"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      

      
      <div class="read-next-item">
        <a href="/2019/10/20/effectivego-new-make-slice.html" class="read-next-link"></a>
          <section>
            <span>《原汁原味 Go 语言学习》(6) effective go 数据部分：new与make、数组与切片</span>
            <p></p>
          </section>
          
          <div class="filter"></div>
          <img src="" alt="">
          
      </div>
      
    </section>
    <section class="post-footer-item comment">
      <div id="disqus_thread"></div>
    </section>
  </section>

  <footer class="g-footer">
  <section>敬维 ©
  
  
    2018
    -
  
  2019
  <a href="/rss.xml">RSS订阅</a>
  </section>
</footer>


  <script src="/assets/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  

  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
</body>

</html>
